<!DOCTYPE html>

<html>
<head>
  <title>TileDataSet.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="AgentSet.html">
                  AgentSet.js
                </a>
              
                
                <a class="source" href="Animator.html">
                  Animator.js
                </a>
              
                
                <a class="source" href="Color.html">
                  Color.js
                </a>
              
                
                <a class="source" href="ColorMap.html">
                  ColorMap.js
                </a>
              
                
                <a class="source" href="DataSet.html">
                  DataSet.js
                </a>
              
                
                <a class="source" href="Model.html">
                  Model.js
                </a>
              
                
                <a class="source" href="Mouse.html">
                  Mouse.js
                </a>
              
                
                <a class="source" href="OofA.html">
                  OofA.js
                </a>
              
                
                <a class="source" href="Patch.html">
                  Patch.js
                </a>
              
                
                <a class="source" href="Patches.html">
                  Patches.js
                </a>
              
                
                <a class="source" href="RGBDataSet.html">
                  RGBDataSet.js
                </a>
              
                
                <a class="source" href="TileDataSet.html">
                  TileDataSet.js
                </a>
              
                
                <a class="source" href="util.html">
                  util.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>TileDataSet.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> util <span class="hljs-keyword">from</span> <span class="hljs-string">'lib/util.js'</span>
<span class="hljs-keyword">import</span> DataSet <span class="hljs-keyword">from</span> <span class="hljs-string">'lib/DataSet.js'</span>
<span class="hljs-keyword">import</span> RGBDataSet <span class="hljs-keyword">from</span> <span class="hljs-string">'lib/RGBDataSet.js'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Load tiled data into a dataset</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TileDataSet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DataSet</span> </span>{

  <span class="hljs-keyword">constructor</span> (options = {}) {
    <span class="hljs-keyword">const</span> width = <span class="hljs-number">1280</span> || options.width
    <span class="hljs-keyword">const</span> height = <span class="hljs-number">800</span> || options.height
    <span class="hljs-keyword">super</span>(width, height, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float32Array</span>(width * height))</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>defaults values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.url = <span class="hljs-string">'http://node.redfish.com/elevation/{z}/{x}/{y}.png'</span>
    <span class="hljs-keyword">this</span>.north = <span class="hljs-number">35</span> <span class="hljs-comment">// northern bound for the data</span>
    <span class="hljs-keyword">this</span>.south = <span class="hljs-number">34.5</span>
    <span class="hljs-keyword">this</span>.west = <span class="hljs-number">-106</span>
    <span class="hljs-keyword">this</span>.east = <span class="hljs-number">-105.5</span>
    <span class="hljs-keyword">this</span>.debug = <span class="hljs-literal">false</span> <span class="hljs-comment">// prints to console if true</span>
    <span class="hljs-keyword">this</span>.tileWidth = <span class="hljs-number">256</span> <span class="hljs-comment">// pixels</span>
    <span class="hljs-keyword">this</span>.tileHeight = <span class="hljs-number">256</span> <span class="hljs-comment">// pixels</span>
    <span class="hljs-keyword">this</span>.maxZoom = <span class="hljs-number">14</span>
    <span class="hljs-keyword">this</span>.minZoom = <span class="hljs-number">10</span>
    <span class="hljs-keyword">this</span>.useFailImage = <span class="hljs-literal">true</span> <span class="hljs-comment">// Fill with something else when image fails to load. if this is false then the the error callback is called when a tile is not found</span>
    <span class="hljs-keyword">this</span>.callback = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, v</span>) </span>{
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'default Error Callback'</span>, err)
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.debug) <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'default success callback'</span>, v)
      }
    }
    <span class="hljs-built_in">Object</span>.assign(<span class="hljs-keyword">this</span>, options)
    <span class="hljs-keyword">this</span>.tileLocations = <span class="hljs-literal">undefined</span>
    <span class="hljs-keyword">this</span>.start()
  }

  start () {
    <span class="hljs-keyword">const</span> zoom = <span class="hljs-keyword">this</span>.zoom || <span class="hljs-keyword">this</span>.calculateGoodZoom()
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.debug) <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'zoom for tiles:'</span>, zoom)
    <span class="hljs-keyword">this</span>.tileLocations = <span class="hljs-keyword">this</span>.calculateTilesNeeded(zoom)
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.debug) <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'calculated tiles'</span>, <span class="hljs-keyword">this</span>.tileLocations)</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>download the tiles</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.downloadTiles(<span class="hljs-keyword">this</span>.tileLocations, (err, ev) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-keyword">this</span>.callback(err)
        <span class="hljs-keyword">return</span>
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>â€¦ then do the stitching, cropping, and finally resizing.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">const</span> mosaic = <span class="hljs-keyword">this</span>.stitchTiles(ev)
      <span class="hljs-keyword">const</span> cropped = <span class="hljs-keyword">this</span>.crop(mosaic)
      <span class="hljs-keyword">const</span> resized = cropped.resample(<span class="hljs-keyword">this</span>.width, <span class="hljs-keyword">this</span>.height, <span class="hljs-literal">true</span>)
      <span class="hljs-built_in">console</span>.assert(resized.width === <span class="hljs-keyword">this</span>.width &amp;&amp; resized.height === <span class="hljs-keyword">this</span>.height, <span class="hljs-string">'Dimensions are wrong'</span>, resized)
      <span class="hljs-keyword">this</span>.data = resized.data
      <span class="hljs-keyword">this</span>.callback(<span class="hljs-literal">undefined</span>, <span class="hljs-keyword">this</span>)
    })
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>calculate good zoom level to use.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calculateGoodZoom () {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>How many tile subdivisions in the longitude width</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> bW = <span class="hljs-built_in">Math</span>.abs(<span class="hljs-keyword">this</span>.east - <span class="hljs-keyword">this</span>.west)
    <span class="hljs-keyword">const</span> z1 = <span class="hljs-built_in">Math</span>.log(<span class="hljs-number">360</span> / bW) / <span class="hljs-built_in">Math</span>.log(<span class="hljs-number">2</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>calc how many tile subdivisisions it will take to make the width pixels</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> z2 = <span class="hljs-built_in">Math</span>.log(<span class="hljs-keyword">this</span>.width / <span class="hljs-keyword">this</span>.tileWidth) / <span class="hljs-built_in">Math</span>.log(<span class="hljs-number">2</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>add them together and round</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> z3 = <span class="hljs-built_in">Math</span>.round(z1 + z2)
    <span class="hljs-built_in">console</span>.log(z3)</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>clamp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> z4 = <span class="hljs-built_in">Math</span>.min(<span class="hljs-keyword">this</span>.maxZoom, <span class="hljs-built_in">Math</span>.max(<span class="hljs-keyword">this</span>.minZoom, z3))
    <span class="hljs-keyword">return</span> z4
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Which tiles do we need to donwload</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calculateTilesNeeded (zoom) {
    <span class="hljs-keyword">const</span> ulTile = [<span class="hljs-keyword">this</span>.long2tile(<span class="hljs-keyword">this</span>.west, zoom), <span class="hljs-keyword">this</span>.lat2tile(<span class="hljs-keyword">this</span>.north, zoom)]
    <span class="hljs-keyword">const</span> lrTile = [<span class="hljs-keyword">this</span>.long2tile(<span class="hljs-keyword">this</span>.east, zoom), <span class="hljs-keyword">this</span>.lat2tile(<span class="hljs-keyword">this</span>.south, zoom)]
    <span class="hljs-keyword">const</span> count = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]
    <span class="hljs-keyword">const</span> tileUL = [<span class="hljs-keyword">this</span>.tile2lat(ulTile[<span class="hljs-number">0</span>], ulTile[<span class="hljs-number">1</span>], zoom), <span class="hljs-keyword">this</span>.tile2long(ulTile[<span class="hljs-number">0</span>], ulTile[<span class="hljs-number">1</span>], zoom)]
    <span class="hljs-keyword">const</span> tileLR = [<span class="hljs-keyword">this</span>.tile2lat(lrTile[<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>, lrTile[<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>, zoom), <span class="hljs-keyword">this</span>.tile2long(lrTile[<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>, lrTile[<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>, zoom)]
    <span class="hljs-keyword">const</span> result = {width: lrTile[<span class="hljs-number">0</span>] - ulTile[<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>,
            height: lrTile[<span class="hljs-number">1</span>] - ulTile[<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>,
            UL: tileUL,
            LR: tileLR,
            tiles: []}</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>loop from upperleft tile to lower right tile and put results into list called result.tiles</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> x = ulTile[<span class="hljs-number">0</span>]; x &lt;= lrTile[<span class="hljs-number">0</span>]; x++) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> y = ulTile[<span class="hljs-number">1</span>]; y &lt;= lrTile[<span class="hljs-number">1</span>]; y++) {
        <span class="hljs-keyword">let</span> url = <span class="hljs-built_in">String</span>(<span class="hljs-keyword">this</span>.url)
        url = url.replace(<span class="hljs-string">'{x}'</span>, x).replace(<span class="hljs-string">'{y}'</span>, y).replace(<span class="hljs-string">'{z}'</span>, zoom)
        <span class="hljs-keyword">const</span> res = { imgX: count[<span class="hljs-number">0</span>], imgY: count[<span class="hljs-number">1</span>], x: x, y: y, url: url }
        result.tiles.push(res)</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        count[<span class="hljs-number">1</span>]++
      }
      count[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>
      count[<span class="hljs-number">0</span>]++
    }
    <span class="hljs-keyword">return</span> result
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>DOWNLOAD</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  downloadTiles (tileLocs, successCallback) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.debug) <span class="hljs-built_in">console</span>.time(<span class="hljs-string">'downloadTiles'</span>)
    <span class="hljs-keyword">const</span> promises = []
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> i <span class="hljs-keyword">of</span> <span class="hljs-keyword">this</span>.tileLocations.tiles) {
      <span class="hljs-keyword">const</span> pr = util.imagePromise(i.url) <span class="hljs-comment">// this.LFwrapPromiseFactory(i.url, i)</span>
      promises.push(pr)
    }
    <span class="hljs-built_in">Promise</span>.all(promises).then((ev) =&gt; {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.debug) <span class="hljs-built_in">console</span>.timeEnd(<span class="hljs-string">'downloadTiles'</span>)
      successCallback(<span class="hljs-literal">null</span>, ev)
    }).catch((err) =&gt; {
      <span class="hljs-keyword">this</span>.callback(err)
    })
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>if the download fails this makes the data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  makeFailDataSet () {
    <span class="hljs-keyword">var</span> ds = <span class="hljs-keyword">new</span> DataSet(<span class="hljs-keyword">this</span>.tileWidth, <span class="hljs-keyword">this</span>.tileHeight, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float32Array</span>(<span class="hljs-keyword">this</span>.tileWidth * <span class="hljs-keyword">this</span>.tileHeight))
    ds.useNearest = <span class="hljs-keyword">this</span>.useNearest
    <span class="hljs-keyword">return</span> ds
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>STITCH</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  stitchTiles (tiles) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.debug) <span class="hljs-built_in">console</span>.time(<span class="hljs-string">'stitching'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Stitch all tiles into a mosaic</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> wid = <span class="hljs-keyword">this</span>.tileLocations.width * <span class="hljs-keyword">this</span>.tileWidth
    <span class="hljs-keyword">const</span> hei = <span class="hljs-keyword">this</span>.tileLocations.height * <span class="hljs-keyword">this</span>.tileHeight
    <span class="hljs-keyword">const</span> stitched = <span class="hljs-keyword">new</span> DataSet(wid, hei, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float32Array</span>(wid * hei))
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> im <span class="hljs-keyword">of</span> tiles) {
      <span class="hljs-keyword">const</span> md = <span class="hljs-keyword">this</span>.tileLocations.tiles.find((a) =&gt; {
        <span class="hljs-keyword">return</span> im.src === a.url
      })
      <span class="hljs-built_in">console</span>.assert(md, <span class="hljs-string">'image metadata not found'</span>)
      <span class="hljs-keyword">let</span> ds
      <span class="hljs-keyword">if</span> (!im.naturalWidth) { <span class="hljs-comment">// happens when image fails to load</span>
        ds = <span class="hljs-keyword">this</span>.makeFailDataSet()
      } <span class="hljs-keyword">else</span> {
        ds = <span class="hljs-keyword">new</span> RGBDataSet(im)
      }
      stitched.paste(ds, md.imgX * <span class="hljs-keyword">this</span>.tileWidth, md.imgY * <span class="hljs-keyword">this</span>.tileHeight)
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.debug) <span class="hljs-built_in">console</span>.timeEnd(<span class="hljs-string">'stitching'</span>)
    <span class="hljs-keyword">return</span> stitched
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Extract area of iterest from stitched image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  crop (stitched) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.debug) <span class="hljs-built_in">console</span>.time(<span class="hljs-string">'cropping'</span>)
    <span class="hljs-keyword">const</span> wid = stitched.width
    <span class="hljs-keyword">const</span> hei = stitched.height
    <span class="hljs-keyword">const</span> tl = <span class="hljs-keyword">this</span>.tileLocations
    <span class="hljs-keyword">const</span> bindUL = [(<span class="hljs-keyword">this</span>.west - tl.UL[<span class="hljs-number">1</span>]), -(<span class="hljs-keyword">this</span>.north - tl.UL[<span class="hljs-number">0</span>])]
    <span class="hljs-keyword">const</span> bndLR = [(<span class="hljs-keyword">this</span>.east - tl.UL[<span class="hljs-number">1</span>]), -(<span class="hljs-keyword">this</span>.south - tl.UL[<span class="hljs-number">0</span>])]
    <span class="hljs-keyword">const</span> dimT = [tl.LR[<span class="hljs-number">1</span>] - tl.UL[<span class="hljs-number">1</span>], -(tl.LR[<span class="hljs-number">0</span>] - tl.UL[<span class="hljs-number">0</span>])]
    <span class="hljs-keyword">let</span> pxUL = [wid * (bindUL[<span class="hljs-number">0</span>] / dimT[<span class="hljs-number">0</span>]), hei * (bindUL[<span class="hljs-number">1</span>] / dimT[<span class="hljs-number">1</span>])]
    <span class="hljs-keyword">let</span> pxLR = [wid * (bndLR[<span class="hljs-number">0</span>] / dimT[<span class="hljs-number">0</span>]), hei * (bndLR[<span class="hljs-number">1</span>] / dimT[<span class="hljs-number">1</span>])]
    pxUL = [<span class="hljs-built_in">Math</span>.round(pxUL[<span class="hljs-number">0</span>]), <span class="hljs-built_in">Math</span>.round(pxUL[<span class="hljs-number">1</span>])]
    pxLR = [<span class="hljs-built_in">Math</span>.round(pxLR[<span class="hljs-number">0</span>]), <span class="hljs-built_in">Math</span>.round(pxLR[<span class="hljs-number">1</span>])]
    <span class="hljs-keyword">const</span> extraction = stitched.subset(pxUL[<span class="hljs-number">0</span>], pxUL[<span class="hljs-number">1</span>], pxLR[<span class="hljs-number">0</span>] - pxUL[<span class="hljs-number">0</span>], pxLR[<span class="hljs-number">1</span>] - pxUL[<span class="hljs-number">1</span>])
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.debug) <span class="hljs-built_in">console</span>.timeEnd(<span class="hljs-string">'cropping'</span>)
    <span class="hljs-keyword">return</span> extraction
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p> Slippy Tile Helpers
  <a href="http://wiki.openstreetmap.org/wiki/Slippy_map_tilenames">http://wiki.openstreetmap.org/wiki/Slippy_map_tilenames</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  long2tile (lon, zoom) {
    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">Math</span>.floor((lon + <span class="hljs-number">180</span>) / <span class="hljs-number">360</span> * <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">2</span>, zoom)))
  }
  lat2tile (lat, zoom) {
    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">Math</span>.floor((<span class="hljs-number">1</span> - <span class="hljs-built_in">Math</span>.log(<span class="hljs-built_in">Math</span>.tan(lat * <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">180</span>) + <span class="hljs-number">1</span> / <span class="hljs-built_in">Math</span>.cos(lat * <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">180</span>)) / <span class="hljs-built_in">Math</span>.PI) / <span class="hljs-number">2</span> * <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">2</span>, zoom)))
  }

  tile2long (x, y, z) {
    <span class="hljs-keyword">return</span> (x / <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">2</span>, z) * <span class="hljs-number">360</span> - <span class="hljs-number">180</span>)
  }

  tile2lat (x, y, z) {
    <span class="hljs-keyword">const</span> n = <span class="hljs-built_in">Math</span>.PI - <span class="hljs-number">2</span> * <span class="hljs-built_in">Math</span>.PI * y / <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">2</span>, z)
    <span class="hljs-keyword">return</span> (<span class="hljs-number">180</span> / <span class="hljs-built_in">Math</span>.PI * <span class="hljs-built_in">Math</span>.atan(<span class="hljs-number">0.5</span> * (<span class="hljs-built_in">Math</span>.exp(n) - <span class="hljs-built_in">Math</span>.exp(-n))))
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> TileDataSet</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
