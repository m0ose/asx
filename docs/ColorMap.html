<!DOCTYPE html>

<html>
<head>
  <title>ColorMap.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="AgentSet.html">
                  AgentSet.js
                </a>
              
                
                <a class="source" href="Color.html">
                  Color.js
                </a>
              
                
                <a class="source" href="ColorMap.html">
                  ColorMap.js
                </a>
              
                
                <a class="source" href="DataSet.html">
                  DataSet.js
                </a>
              
                
                <a class="source" href="OofA.html">
                  OofA.js
                </a>
              
                
                <a class="source" href="util.html">
                  util.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>ColorMap.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> util <span class="hljs-keyword">from</span> <span class="hljs-string">'./util.js'</span>
<span class="hljs-keyword">import</span> Color <span class="hljs-keyword">from</span> <span class="hljs-string">'./Color.js'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>A colormap is simply an array of typedColors with a few utilities such
as randomColor etc. This allows the colors to be simple integer indices
into the Array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> ColorMap = {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h3 id="color-array-utilities">Color Array Utilities</h3>
<p>Several utilities for creating color arrays</p>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h3 id="gradients">Gradients</h3>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Ask the browser to use the canvas gradient feature
to create nColors given the gradient color stops and locs.
See Mozilla <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/linear-gradient">Gradient Doc</a>,</p>
<p>Stops are css strings or rgba arrays.
Locs are floats from 0-1, default is equally spaced.</p>
<p>This is a powerful browser feature, can be
used to create all the MatLab colormaps.
See these gradient sites:
Colorzilla <a href="http://www.colorzilla.com/gradient-editor/">Gradient Editor</a>,
GitHub <a href="https://github.com/bpostlethwaite/colormap">ColorMap Project</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  gradientImageData (nColors, stops, locs) {</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Convert the color stops to css strings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    stops = stops.map((c) =&gt; <span class="hljs-built_in">Array</span>.isArray(c) ? Color.rgbaString(...c) : c)
    <span class="hljs-keyword">const</span> ctx = util.createCtx(nColors, <span class="hljs-number">1</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Install default locs if none provide</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!locs) locs = util.aRamp(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, stops.length)</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>create a new gradient and fill it with the color stops</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> grad = ctx.createLinearGradient(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, nColors, <span class="hljs-number">0</span>)
    util.repeat(stops.length, (i) =&gt; grad.addColorStop(locs[i], stops[i]))</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>draw the gradient returning the image data TypedArray</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ctx.fillStyle = grad
    ctx.fillRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, nColors, <span class="hljs-number">1</span>)
    <span class="hljs-keyword">return</span> util.ctxToImageData(ctx).data
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h3 id="array-conversion-utilities">Array Conversion Utilities</h3>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Convert Uint8Array into Array of 4 element typedColors.
Useful for converting ImageData objects like gradients to colormaps.
WebGL ready: the array.typedArray is suitable for Attribute Buffers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  typedArrayToTypedColors (typedArray) {
    <span class="hljs-keyword">const</span> array = []
    util.step(typedArray.length, <span class="hljs-number">4</span>,
      (i) =&gt; array.push(Color.typedColor(typedArray.subarray(i, i + <span class="hljs-number">4</span>))))
    array.typedArray = typedArray
    <span class="hljs-keyword">return</span> array
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Convert an Array of Arrays to an Array of typedColors
Webgl ready as above.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  arrayToColors (array) {
    <span class="hljs-keyword">const</span> typedArray = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8ClampedArray</span>(array.length * <span class="hljs-number">4</span>)
    util.repeat(array.length, (i) =&gt; {
      <span class="hljs-keyword">const</span> a = array[i]
      <span class="hljs-keyword">if</span> (a.length === <span class="hljs-number">3</span>) a.push(<span class="hljs-number">255</span>)
      typedArray.set(a, i * <span class="hljs-number">4</span>)
    })
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.typedArrayToTypedColors(typedArray)
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Permute the values of 3 arrays. Ex:</p>
<p>[1,2], [3], [4,5] -&gt; [ [1,3,4],[1,3,5],[2,3,4],[2,3,5] ]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  permuteArrays (A1, A2 = A1, A3 = A1) {
    <span class="hljs-keyword">const</span> array = []
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> a1 <span class="hljs-keyword">of</span> A1)
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> a2 <span class="hljs-keyword">of</span> A2)
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> a3 <span class="hljs-keyword">of</span> A3)
          array.push([a1, a2, a3])
    <span class="hljs-keyword">return</span> array
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Use permuteArrays to create uniformly spaced color ramp permutation.
Ex: if numRs is 3, permuteArraysâ€™s A1 would be [0, 127, 255]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  permuteRGBColors (numRs, numGs = numRs, numBs = numRs) {
    <span class="hljs-keyword">const</span> toRamp = (num) =&gt; util.aIntRamp(<span class="hljs-number">0</span>, <span class="hljs-number">256</span>, num)
    <span class="hljs-keyword">const</span> ramps = [numRs, numGs, numBs].map(toRamp)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.permuteArrays(...ramps)
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h3 id="colormaps">ColorMaps</h3>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>ColorMaps are Arrays of TypedColors with these methods.
Webgl ready if made with typedArrayToTypedColors or arrayToColors above.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ColorMapProto: {
    __proto__: <span class="hljs-built_in">Array</span>.prototype,</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Create a <a href="https://goo.gl/lQlq5k">sparse array</a> of index[pixel] = pixel.
Used by lookup below for exact match of a color within the colormap.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    createIndex () {
      <span class="hljs-keyword">this</span>.index = []
      util.repeat(<span class="hljs-keyword">this</span>.length, (i) =&gt; {
        <span class="hljs-keyword">const</span> px = <span class="hljs-keyword">this</span>[i].getPixel()
        <span class="hljs-keyword">this</span>.index[px] = i
      })
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Return a random index into the colormap array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    randomIndex () { <span class="hljs-keyword">return</span> util.randomInt(<span class="hljs-keyword">this</span>.length) },</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Return a random color within the colormap</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    randomColor () { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>[<span class="hljs-keyword">this</span>.randomIndex()] },</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Return the index of a color within the colormap, undefined if no match.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    lookup (color) {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.index) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.index[color.getPixel()]
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.length; i++)
        <span class="hljs-keyword">if</span> (color.equals(<span class="hljs-keyword">this</span>[i])) <span class="hljs-keyword">return</span> i
      <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Return color scaled by number within [min, max].
A linear interpolation (util.lerp) in [0, length-1]</p>
<p>Ex: scaleColor(25, 0, 50) returns the color in the middle of the colormap</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    scaleColor (number, min, max) {</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>number = util.clamp(number, min, max)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">const</span> scale = util.lerpScale(number, min, max)
      <span class="hljs-keyword">const</span> index = <span class="hljs-built_in">Math</span>.round(util.lerp(<span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.length - <span class="hljs-number">1</span>, scale))
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>[index]
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Return the typedArray used to create the typedColors,
undefined if not webgl ready.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    webglArray () { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.typedArray }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>findClosestIndex: function(r, g, b, a) {
  var b0, bLoc, c, color, d, g0, gLoc, i, ix, ixMin, j, len, minDist, r0, rLoc, ref, ref1, ref2, step;
  if (a == null) {
    a = 255;
  }
  if (g == null) {
    ref = Color.colorToArray(r), r = ref[0], g = ref[1], b = ref[2], a = ref[3];
  }
  if (this.cube) {
    step = 255 / (this.cube - 1);
    ref1 = (function() {
      var j, len, ref1, results;
      ref1 = [r, g, b];
      results = [];
      for (j = 0, len = ref1.length; j &lt; len; j++) {
        c = ref1[j];
        results.push(Math.round(c / step));
      }
      return results;
    })(), rLoc = ref1[0], gLoc = ref1[1], bLoc = ref1[2];
    return rLoc + gLoc <em> this.cube + bLoc </em> this.cube * this.cube;
  }
  if (ix = this.lookup([r, g, b, a])) {
    return ix;
  }
  minDist = Infinity;
  ixMin = 0;
  for (i = j = 0, len = this.length; j &lt; len; i = ++j) {
    color = this[i];
    ref2 = Color.colorToArray(color), r0 = ref2[0], g0 = ref2[1], b0 = ref2[2];
    d = Color.rgbDistance(r0, g0, b0, r, g, b);
    if (d &lt; minDist) {
      minDist = d;
      ixMin = i;
    }
  }
  return ixMin;
},
findClosestColor: function(r, g, b, a) {
  if (a == null) {
    a = 255;
  }
  return this[this.findClosestIndex(r, g, b, a)];
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  },</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Convert an array of rgb(a) arrays to a webgl-ready colormap.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  basicColorMap (array) {
    array = <span class="hljs-keyword">this</span>.arrayToColors(array)
    util.setPrototypeOf(array, <span class="hljs-keyword">this</span>.ColorMapProto)
    <span class="hljs-keyword">return</span> array
  }

}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> ColorMap</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
